<!DOCTYPE html>
<html lang="en">
    <head>
    <title>How to Instantly Migrate Nette\Tester to PHPUnit | Tomas Votruba</title>
    <meta charset="utf-8">
    <meta name="robots" content="index, follow">

        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">

    
    <link rel="alternate" type="application/rss+xml" title="Tomas Votruba Blog RSS" href="/rss.xml">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/solid.css" integrity="sha384-wnAC7ln+XN0UKdcPvJvtqIH3jOjs9pnKnq9qX68ImXvOGz2JuFoEiCjT8jyZQX2z" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/brands.css" integrity="sha384-nT8r1Kzllf71iZl81CdFzObMsaLOhqBU1JD2+XoAALbdtWaXDOlWOZTR4v1ktjPE" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/fontawesome.css" integrity="sha384-HbmWTHay9psM8qyzEKPc8odH4DsOuzdejtnr+OFtDmOcIVnhgReQ4GZBH7uwcjf6" crossorigin="anonymous">

        <link href="/assets/bootstrap/bootstrap.min.css" rel="stylesheet" type="text/css" />

    <link href="/assets/prism/prism.css" rel="stylesheet" type="text/css" />

        <link href="/assets/css/style.css" rel="stylesheet" type="text/css" />


        <link href="/assets/css/checklist.css" rel="stylesheet" type="text/css" />
</head>
    <body>
                <!-- post_id: 197 -->

        
<div class="hidden-sm-down">
    <nav class="navbar">
        <div class="container-fluid">
            <ul>
                <li id="logo">
                    <img src="https://avatars1.githubusercontent.com/u/924196?s=60&v=4" class="me_avatar">
                    Tomas Votruba
                </li>
                <li class="active">
                    <a href="/">Blog</a>
                </li>
                <li class="">
                    <a href="/php-framework-trends">Trends</a>
                </li>
                <li class="">
                    <a href="/clusters">Clusters</a>
                </li>
                <li class="">
                    <a href="/projects">Projects</a>
                </li>
                <li class="">
                    <a href="/mission">Mission</a>
                </li>
                <li class="">
                    <a href="/contact">Contact</a>
                </li>
                <li id="top-menu-search">
                    <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="https://schema.org/SearchAction">
    <meta itemprop="target" content="https://www.google.com/search?q={q}"/>
    <input name="sitesearch" value="tomasvotruba.com" type="hidden"/>
    <input itemprop="query-input" type="text" id="search-query" class="form-control" required="required" name="q" placeholder="Search..." autocomplete="off"/>
</form>
                </li>
            </ul>
        </div>
    </nav>
</div>

<div class="hidden-md-up">
    <nav class="navbar" id="mobile-menu">
        <div class="container">
            <a href="/" class="col-3 col-sm-3 active">
                <em class="fas fa-book"></em>
                <br>
                Blog
            </a>


            <a href="/clusters" class="col-3 col-sm-3 ">
                <em class="fas fa-share-alt"></em>
                <br>
                Clusters
            </a>

            <a href="/projects" class="col-3 col-sm-3 ">
                <em class="fas fa-chart-bar"></em>
                <br>
                Trends
            </a>

            <a href="/contact" class="col-3 col-sm-3 ">
                <em class="fas fa-phone"></em>
                <br>
                Contact
            </a>
        </div>
    </nav>

    <div class="hidden-md-up text-center" id="top-menu-search-mobile">
        <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="https://schema.org/SearchAction">
    <meta itemprop="target" content="https://www.google.com/search?q={q}"/>
    <input name="sitesearch" value="tomasvotruba.com" type="hidden"/>
    <input itemprop="query-input" type="text" id="search-query" class="form-control" required="required" name="q" placeholder="Search..." autocomplete="off"/>
</form>
    </div>
</div>

        <div class="container-fluid" id="post">
            <h1>How to Instantly Migrate Nette\Tester to PHPUnit</h1>

            <ul class="list-inline post-metadata">
    <li class="list-inline-item mr-3">
        <em class="fas fa-clock fa-fw"></em>
        <strong>3 min</strong>
    </li>

    <li class="list-inline-item mr-3">
        <em class="fas fa-calendar fa-fw"></em>
        <time datetime="2019-03-Mon">
            <strike>
                            Mar, 2019
            
            </strike>        </time>
    </li>

            <li class="list-inline-item mr-3 text-success">
            <em class="fas fa-fw fa-sync"></em> Updated Nov, 2020
        </li>
    
            <li class="list-inline-item mr-3">
            <em class="fas fa-fw fa-comments"></em>
            <a href="/blog/2019/03/25/how-to-instantly-migrate-nette-tester-to-phpunit/#disqus_thread">X</a> comments
        </li>
    
    
            <li class="list-inline-item mr-3 text-primary">
            <em class="fab fa-fw fa-github"></em>
            <a href="https://github.com/tomasvotruba/tomasvotruba.com/edit/master/packages/blog/data/2019/2019-03-25-how-to-instantly-migrate-nette-tester-to-phpunit.md">Found a typo? Edit me</a>
        </li>
    </ul>

            
                            <div class="card border-success card-bigger mt-5">
                    <div class="card-header text-white bg-success">
                        <strong>This post was updated at November 2020</strong>
                    </div>
                                            <div class="card-body pb-2">
                            <p>Switch from deprecated <code>--set</code> option to <code>rector.php</code> config.</p>
                        </div>
                                    </div>

                <br>
            
            <div class="card card-bigger mb-5">
                <div class="card-body pb-2">
                    <p>We had üç∫ after PHP meetup in Prague and Tomas asked me:
<br>
&quot;We don't use Nette, but we still have many tests in Tester. Can Rector migrate them to PHPUnit?&quot;
<br>
&quot;Hold my üç∫&quot;</p>
                </div>
            </div>

            <p>In the last post we looked on <a href="/blog/2019/03/21/how-to-instantly-migrate-phpspec-to-phpunit">instant migration of PhpSpec to PHPUnit</a>.</p>
<p>PhpSpec has a different architecture than PHPUnit - e.g.</p>
<ul>
<li>PHPUnit creates mocks in body of tested method <code>$this-&gt;createMock()</code> ,</li>
<li>but PhpSpec puts them in parameters <code>public function is_should_work(Category $categoryMock)</code>.</li>
</ul>
<p>This has a huge influence on the code, so <strong>it took a week to cover these differences in migration path</strong>.</p>
<p>How does Tester compare to PHPUnit?</p>
<h2 id="trends-revealed">Trends Revealed</h2>
<p>In the last post we looked at absolute downloads and trends of 3 PHP unit test frameworks:</p>
<div class="row text-center mb-5 mt-5">
    <div class="col-md-4 col-sm-4">
        <a href="https://packagist.org/packages/nette/tester/stats">
            <img src="/assets/images/posts/2019/unit-mig/tester.png"><br><em>1 mil. downloads - Tester</em>
        </a>
    </div>
    <div class="col-md-4 col-sm-4">
        <a href="https://packagist.org/packages/phpspec/phpspec/stats">
            <img src="/assets/images/posts/2019/unit-mig/spec.png"><br><em>14 mils. downloads - PhpSpec</em>
        </a>
    </div>
    <div class="col-md-4 col-sm-4">
        <a href="https://packagist.org/packages/phpunit/phpunit/stats">
            <img src="/assets/images/posts/2019/unit-mig/phpunit.png"><br><em>117 mils. downloads - PHPUnit</em>
        </a>
    </div>
</div>
<p>Putting numbers and trends aside - <strong>this is about your needs</strong>. Do you need to change from Doctrine to Eloquent? From Symfony 4.2 to Laravel 5.8? From Symfony to Nette? Go for it, Rector will help you with the boring PHP work you'd love to skip.</p>
<p>The guy in the pub that night needed this, so...  <em>challenge accepted</em>!</p>
<h2 id="single-test-case">Single Test Case</h2>
<p>Luckily, Tester and PHPUnit are like twins:</p>
<ul>
<li>share the same approach in configuring tests - <code>setUp</code> &amp; <code>tearDown</code></li>
<li>do assert with a call - <code>Assert::true($value)</code> vs. <code>self::assertTrue($value)</code></li>
<li>do share naming  - <code>public function testSomething()</code></li>
<li>do share data providers - <code>@dataProvider</code></li>
</ul>
<p>So all <strong>we need to do is rename a few methods</strong>? There are still a few gotchas:</p>
<ul>
<li><code>Assert::exception()</code> uses code inside anonymous function, while in PHPUnit it's just above the code that should fail</li>
<li>Tester includes bootstrap itself, PHPUnit include in <code>phpunit.xml</code></li>
<li>Tester creates the test under the test <code>(new SomeTest())-&gt;run()</code>, PHPUnit creates them automatically</li>
</ul>
<p>Luckily, last 2 operations are subtractions, so we can just remove them.</p>
<h3 id="and-the-result">And the Result?</h3>
<pre><code class="language-diff"> &lt;?php

 namespace App\Tests;

 use App\Entity\SomeObject;
-use Tester\Assert;
-use Tester\TestCase;

-require_once __DIR__ . '/bootstrap.php';

-class ExpensiveObjectTest extends TestCase
+class ExpensiveObjectTest extends \PHPUnit\Framework\TestCase
 {
     public function testSwitches()
     {
-        Assert::false(5);
+        $this-&gt;assertFalse(5);

-        Assert::falsey('value', 'some messsage');
+        $this-&gt;assertFalse((bool) 'value', 'some messsage');

-        Assert::truthy(true);
+        $this-&gt;assertTrue(true);
     }

     public function testTypes()
     {
         $value = 'x';
-        Assert::type('array', $value);
+        $this-&gt;assertIsArray($value);

-        Assert::type(SomeObject::class, $value);
+        $this-&gt;assertInstanceOf(SomeObject::class, $value);
     }

     public function testException()
     {
         $someObject = new SomeObject;
-        Assert::exception(function () use ($someObject) {
-            $someObject-&gt;setPrice('twenty dollars');
-        }, InvalidArgumentException::class, 'Price should be string, you know');
+        $this-&gt;expectException(InvalidArgumentException::class);
+        $this-&gt;expectExceptionMessage('Price should be string, you know');
+        $someObject-&gt;setPrice('twenty dollars');
     }

+    /**
+     * @doesNotPerformAssertions
+     */
     public function testNoError()
     {
-        Assert::noError(function () {
-             new SomeObject(25)
-        });
+        new SomeObject(25);
     }
 }

-(new ExpensiveObjectTest())-&gt;run();</code></pre>
<h2 id="how-to-instantly-migrate-from-nette-tester-to-phpunit">How to Instantly Migrate from Nette\Tester to PHPUnit?</h2>
<ol>
<li>Install Rector</li>
</ol>
<pre><code class="language-bash">composer require rector/rector --dev</code></pre>
<ol start="2">
<li>Add <code>rector.php</code> config:</li>
</ol>
<pre><code class="language-php">// rector.php
use Rector\Core\Configuration\Option;
use Rector\Set\ValueObject\SetList;
use Symfony\Component\DependencyInjection\Loader\Configurator\ContainerConfigurator;

return static function (ContainerConfigurator $containerConfigurator): void {
    $parameters = $containerConfigurator-&gt;parameters();
    $parameters-&gt;set(Option::SETS, [SetList::NETTE_TESTER_TO_PHPUNIT]);
};</code></pre>
<ol start="3">
<li>Run it on <code>/tests</code> directory</li>
</ol>
<pre><code class="language-bash">vendor/bin/rector process tests</code></pre>
<p>Then take few minutes to polish the details that Rectors missed and send the PR to your project
<em class="fas fa-fw fa-check text-success fa-lg"></em></p>
<p><br></p>
<p>Happy coding!</p>

            <br>

            <div class="row mb-5 mt-5">
                <div class="col-12 mb-5">
                                                                <a href="/blog/2019/03/21/how-to-instantly-migrate-phpspec-to-phpunit" class="d-block pt-4 pb-4 pl-4 pr-4 btn btn-success btn-wrappable">
                            <em class="fas fa-fw fa-forward"></em>
                            <strong>Read Next</strong>
                            <br>
                            <span class="text-bigger">
                                How to Instantly Migrate PhpSpec to PHPUnit
                            </span>
                        </a>
                                    </div>
            </div>

            <br>

            <a name="comments"></a>
            <div id="disqus_thread"></div>

<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://itsworthsharing.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
        </div>

        <script id="dsq-count-scr" src="https://itsworthsharing.disqus.com/count.js" async defer></script>

        <script src="/assets/js/jquery-3.3.1.slim.min.js"></script>
<script src="/assets/js/cleaning-lady-checklist.js"></script>

<script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>

<script>
    ga=function(){ ga.q.push(arguments) };
    ga.q=[];
    ga.l=+new Date;
    ga('create', 'UA-46082345-1', 'auto');
    ga('send','pageview');
</script>
<script src="https://www.google-analytics.com/analytics.js" async defer></script>

<script src="/assets/prism/prism.js"></script>

<script>
    // sortable table
    $('.sortable_table').DataTable({
        // see https://datatables.net/examples/basic_init/filter_only.html
        "searching": false,
        "paging": false,
        "info": false,
        "order": [[1, "desc"]],
        // see https://datatables.net/examples/advanced_init/sort_direction_control.html
        "aoColumns": [
            null,
            { "orderSequence": [ "desc", "asc" ] },
            { "orderSequence": [ "desc", "asc" ] },
            { "orderSequence": [ "desc", "asc" ] }
        ]
    });
</script>

<div class="text-center mt-5" id="footer">
    <p class="mt-2">
        Open-source is my life. Does it help yours? You can <a href="https://github.com/sponsors/TomasVotruba">Sponsor Me</a> &nbsp;
        <em class="fas fa-heart text-danger fa-lg"></em>

        &nbsp;
        <span class="pl-2 pr-2">‚Ä¢</span>
        &nbsp;

        See <a href="/archive">Post Archive</a>
    </p>

    <br>

    <p>
        Did you know my daily focus goes to <strong>turning working with legacy code into joy</strong>?

        <br>

        With awesome <a href="https://getrector.org/">Instant Refactoring tool called Rector</a>.
    </p>
</div>
    </body>
</html>

        <meta property="og:type" content="article" />
    <meta property="og:title" content="How to Instantly Migrate Nette\Tester to PHPUnit" />
    <meta property="og:description" content="We had üç∫ after PHP meetup in Prague and Tomas asked me:

&quot;We don&#039;t use Nette, but we still have many tests in Tester. Can Rector migrate them to PHPUnit?&quot;

&quot;Hold my üç∫&quot;
" />
    <meta property="og:url" content="/blog/2019/03/25/how-to-instantly-migrate-nette-tester-to-phpunit" />

        <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@votrubaT">
    <meta name="twitter:title" content="How to Instantly Migrate Nette\Tester to PHPUnit" />
    <meta name="twitter:description" content="We had üç∫ after PHP meetup in Prague and Tomas asked me:

&quot;We don&#039;t use Nette, but we still have many tests in Tester. Can Rector migrate them to PHPUnit?&quot;

&quot;Hold my üç∫&quot;
" />
