<!DOCTYPE html>
<html lang="en">
    <head>
    <title>Collector Pattern for Dummies | Tomas Votruba</title>
    <meta charset="utf-8">
    <meta name="robots" content="index, follow">

        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">

    
    <link rel="alternate" type="application/rss+xml" title="Tomas Votruba Blog RSS" href="/rss.xml">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/solid.css" integrity="sha384-wnAC7ln+XN0UKdcPvJvtqIH3jOjs9pnKnq9qX68ImXvOGz2JuFoEiCjT8jyZQX2z" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/brands.css" integrity="sha384-nT8r1Kzllf71iZl81CdFzObMsaLOhqBU1JD2+XoAALbdtWaXDOlWOZTR4v1ktjPE" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/fontawesome.css" integrity="sha384-HbmWTHay9psM8qyzEKPc8odH4DsOuzdejtnr+OFtDmOcIVnhgReQ4GZBH7uwcjf6" crossorigin="anonymous">

        <link href="/assets/bootstrap/bootstrap.min.css" rel="stylesheet" type="text/css" />

    <link href="/assets/prism/prism.css" rel="stylesheet" type="text/css" />

        <link href="/assets/css/style.css" rel="stylesheet" type="text/css" />


        <link href="/assets/css/checklist.css" rel="stylesheet" type="text/css" />
</head>
    <body>
                <!-- post_id: 114 -->

        
<div class="hidden-sm-down">
    <nav class="navbar">
        <div class="container-fluid">
            <ul>
                <li id="logo">
                    <img src="https://avatars1.githubusercontent.com/u/924196?s=60&v=4" class="me_avatar">
                    Tomas Votruba
                </li>
                <li class="active">
                    <a href="/">Blog</a>
                </li>
                <li class="">
                    <a href="/php-framework-trends">Trends</a>
                </li>
                <li class="">
                    <a href="/clusters">Clusters</a>
                </li>
                <li class="">
                    <a href="/projects">Projects</a>
                </li>
                <li class="">
                    <a href="/mission">Mission</a>
                </li>
                <li class="">
                    <a href="/talks">Talks</a>
                </li>
                <li class="">
                    <a href="/contact">Contact</a>
                </li>
                <li id="top-menu-search">
                    <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction">
    <meta itemprop="target" content="https://www.google.com/search?q={q}"/>
    <input name="sitesearch" value="tomasvotruba.com" type="hidden"/>
    <input itemprop="query-input" type="text" id="search-query" class="form-control" required="required" name="q" placeholder="Search..." autocomplete="off"/>
</form>
                </li>
            </ul>
        </div>
    </nav>
</div>

<div class="hidden-md-up">
    <nav class="navbar" id="mobile-menu">
        <div class="container">
            <a href="/" class="col-3 col-sm-3 active">
                <em class="fas fa-book"></em>
                <br>
                Blog
            </a>


            <a href="/clusters" class="col-3 col-sm-3 ">
                <em class="fas fa-share-alt"></em>
                <br>
                Clusters
            </a>

            <a href="/projects" class="col-3 col-sm-3 ">
                <em class="fas fa-chart-bar"></em>
                <br>
                Trends
            </a>

            <a href="/contact" class="col-3 col-sm-3 ">
                <em class="fas fa-phone"></em>
                <br>
                Contact
            </a>
        </div>
    </nav>

    <div class="hidden-md-up text-center" id="top-menu-search-mobile">
        <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction">
    <meta itemprop="target" content="https://www.google.com/search?q={q}"/>
    <input name="sitesearch" value="tomasvotruba.com" type="hidden"/>
    <input itemprop="query-input" type="text" id="search-query" class="form-control" required="required" name="q" placeholder="Search..." autocomplete="off"/>
</form>
    </div>
</div>

        <div class="mainContent">
            <div class="container-fluid" id="post">
                <h1>Collector Pattern for Dummies</h1>

                <ul class="list-inline post-metadata">
    <li class="list-inline-item mr-3">
        <em class="fas fa-clock fa-fw"></em>
        <strong>4 min</strong>
    </li>

    <li class="list-inline-item mr-3">
        <em class="fas fa-calendar fa-fw"></em>
        <time datetime="2018-06-Thu">
            
                            Thu, Jun 14, 2018
            
            </strike>        </time>
    </li>

    
            <li class="list-inline-item mr-3">
            <em class="fas fa-fw fa-comments"></em>
            <a href="/blog/2018/06/14/collector-pattern-for-dummies/#disqus_thread">X</a> comments
        </li>
    
    
            <li class="list-inline-item mr-3 text-primary">
            <em class="fab fa-fw fa-github"></em>
            <a href="https://github.com/tomasvotruba/tomasvotruba.com/edit/master/packages/blog/config/data/2018/2018-06-14-collector-pattern-for-dummies.md">Edit Post</a>
        </li>
    </ul>

                
                
                <div class="card card-bigger mb-5">
                    <div class="card-body">
                        <p>I wrote <em><a href="/blog/2018/03/08/why-is-collector-pattern-so-awesome/">Why is Collector Pattern so Awesome</a></em> a while ago, but I got feeling and feedback that it's way too complicated.
<br><br>
The pattern itself is simple, but put in framework context, it might be too confusing to understand.
<br><br>
That's why we look on collector pattern in minimalistic plain PHP way today.</p>
                    </div>
                </div>

                <p>Let's say you have a simple <code>PriceCalculator</code> class that calculates a price for a product with a VAT:</p>
<pre><code class="language-php">class PriceCalculator
{
    public function calculate(Product $product): float
    {
        // compute vat
        $price = $product-&gt;getPrice() * 1.15;

        return $price;
    }
}</code></pre>
<p>Then we decide to have 50 % discount for admins:</p>
<pre><code class="language-diff"> class PriceCalculator
 {
     public function calculate(Product $product): float
     {
         // compute vat
         $price = $product-&gt;getPrice() * 1.15;

+        // discount for admin
+        if ($this-&gt;currentUser-&gt;getRole() === 'admin') {
+            $price *= 0.5;
+        }
+
         return $price;
     }
 }</code></pre>
<p>And another 20 % discount for students:</p>
<pre><code class="language-diff"> class PriceCalculator
 {
     public function calculate(Product $product): float
     {
         // compute vat
         $price = $product-&gt;getPrice() * 1.15;

         // discount for admin
         if ($this-&gt;currentUser-&gt;getRole() === 'admin') {
             $price *= 0.5;
         }

+        // discount for students
+        if ($this-&gt;currentUser-&gt;getOccupation() === 'student') {
+            $price *= 0.8;
+        }
+
         return $price;
     }
 }</code></pre>
<p>Our <code>PriceCalculator</code> grows and grows, our e-commerce platform expands all over Europe and we found out they have a different strategy to calculate price with VAT. How do we solve it?</p>
<p>&quot;Override the whole class and implements <code>calculate()</code> method for yourself.&quot;</p>
<pre><code class="language-php"> class UnitedKingdomPriceCalculator extends PriceCalculator
 {
     public function calculate(Product $product): float
     {
         // compute vat
         $price = $product-&gt;getPrice() * 1.15;

         return $price;
     }
 }</code></pre>
<p>That's an easy solution for the end-user. But it also means zero reusable code that leads to duplicated work. Imagine there will be 20 websites in the UK and <strong>each of them will have their own code to calculate price with VAT</strong>. 100 % similar code (if written correctly), because it applies to the whole country.</p>
<h2 id="sharing-is-caring">Sharing is Caring</h2>
<p>Instead, such UK solution can be one of many, that is openly shared.</p>
<ul>
<li>Do you need a UK price calculator? Plug it in.</li>
<li>Do you need a configurable discount based on role? Plug it in.</li>
<li>Do you need to decrease all price by 100 € if possible? Plug it in.</li>
</ul>
<p>No need to write it more than once for all of the e-commerce sites.</p>
<h2 id="how-does-that-look-in-the-code">How Does That Look in the Code?</h2>
<h3 id="1-turn-your-main-class-to-a-collector">1. Turn Your Main Class to A Collector</h3>
<pre><code class="language-php">class PriceCalculatorCollector
{
    /**
     * @var PriceCalculatorInterface[]
     */
    private $priceCalculators = [];

    /**
     * @param PriceCalculatorInterface[] $priceCalculators
     */
    public function __construct(array $priceCalculators)
    {
        $this-&gt;priceCalculators = $priceCalculators;
    }

    public function calculate(Product $product): float
    {
        $price = $product-&gt;getPrice();

        foreach ($this-&gt;priceCalculators as $priceCalculator) {
            $price = $priceCalculator-&gt;calculate($price);
        }

        return $price;
    }
}</code></pre>
<p>with interface decoupling:</p>
<pre><code class="language-php">interface PriceCalculatorInterface
{
    public function calculate(float $price): float;
}</code></pre>
<h3 id="2-converts-each-case-to-collected">2. Converts Each Case to Collected</h3>
<pre><code class="language-php">final class CzechVatPriceCalculator implements PriceCalculatorInterface
{
    public function calculate(float $price): float
    {
        return $price * 1.21;
    }
}</code></pre>
<pre><code class="language-php">final class AdminDiscountPriceCalculator implements PriceCalculatorInterface
{
    public function calculate(float $price): float
    {
        if (! $this-&gt;currentUser-&gt;getRole() === 'admin') {
            return $price;
        }

        return $price *= 0.5;
    }
}</code></pre>
<pre><code class="language-php">final class UnitedKingdomPriceCalculator implements PriceCalculatorInterface
{
   public function calculate(float $price): float
   {
       return $price * 1.15;
   }
}</code></pre>
<h3 id="3-let-collector-collect-what-you-need">3. Let Collector Collect What You Need</h3>
<p>Based on your needs, collect this or that service.</p>
<pre><code class="language-php">$priceCalculatorCollector = new PriceCalculatorCollector([
    new AdminDiscountPriceCalculator(),
    new UnitedKingdomPriceCalculator(),
]);

$price = $priceCalculatorCollector-&gt;calculatePrice($product);</code></pre>
<p><em class="fas fa-fw fa-lg fa-check text-success"></em> single entry point for <code>Collector</code></p>
<p><em class="fas fa-fw fa-lg fa-check text-success"></em> each solution that implements <code>PriceCalculatorInterface</code> <strong>is reusable</strong></p>
<p><em class="fas fa-fw fa-lg fa-check text-success"></em> <strong>to extend</strong> <code>PriceCalculatorCollector</code> with another feature, e.g. have a discount for Lenovo laptops from now till the end of June 2018, <strong>we don't have to modify</strong> it - just register a new <code>PriceCalculator</code></p>
<p><em class="fas fa-fw fa-lg fa-check text-success"></em> <strong>to reflect 1 change in reality</strong>, e.g. from 15 % to 20 % VAT, all we need to do it <strong>change 1 class for everyone</strong></p>
<p><br></p>
<p><strong>Win for the end-user, win for your project and win for the code.</strong></p>
<p><br></p>
<p><em>And that's all there is.</em> Just kidding, there is much more, but that's out of the scope of this simple tutorial.
Why the collector class doesn't implement the interface and other questions will be answered in following posts.</p>
<p><br><br></p>
<p>Happy collecting!</p>

                <br>

                <div class="row mb-5 mt-5">
                    <div class="col-12 mb-5">
                                                                            <a href="/blog/2018/06/11/how-to-turn-mocks-from-nightmare-to-solid-kiss-tests" class="d-block pt-4 pb-4 pl-4 pr-4 btn btn-success btn-wrappable">
                                <em class="fas fa-fw fa-forward"></em>
                                <strong>Read Next</strong>
                                <br>
                                <span class="text-bigger">
                                    How to Turn Mocks from Nightmare to Solid Kiss Tests
                                </span>
                            </a>
                                            </div>

                    <div class="col-12">
                        <a href="https://github.com/tomasvotruba/tomasvotruba.com/edit/master/packages/blog/config/data/2018/2018-06-14-collector-pattern-for-dummies.md" class="d-block btn btn-dark btn-wrappable">
                            <em class="fab fa-fw fa-github"></em>
                            <strong>Found a typo?</strong> Fix it and join team of 99&nbsp;contributors
                        </a>
                    </div>
                </div>

                <br>

                <a name="comments"></a>
                <div id="disqus_thread"></div>

<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://itsworthsharing.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
            </div>

            <script id="dsq-count-scr" src="https://itsworthsharing.disqus.com/count.js" async defer></script>
        </div>

        <script src="/assets/js/jquery-3.3.1.slim.min.js"></script>
<script src="/assets/js/cluster-checklist.js"></script>
<script src="/assets/js/cluster-expanable.js"></script>

<script src="/assets/js/cleaning-lady-checklist.js"></script>

<script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>

<script>
    ga=function(){ ga.q.push(arguments) };
    ga.q=[];
    ga.l=+new Date;
    ga('create', 'UA-46082345-1', 'auto');
    ga('send','pageview');
</script>
<script src="https://www.google-analytics.com/analytics.js" async defer></script>

<script src="/assets/prism/prism.js"></script>

<script>
    // sortable table
    $('.sortable_table').DataTable({
        // see https://datatables.net/examples/basic_init/filter_only.html
        "searching": false,
        "paging": false,
        "info": false,
        "order": [[1, "desc"]],
        // see https://datatables.net/examples/advanced_init/sort_direction_control.html
        "aoColumns": [
            null,
            { "orderSequence": [ "desc", "asc" ] },
            { "orderSequence": [ "desc", "asc" ] },
            { "orderSequence": [ "desc", "asc" ] }
        ]
    });
</script>

<div class="text-center mt-5" id="footer">
    <p>
        Thank you <a href="/thank-you">99 people</a>, who contributed this blog

        <span class="pl-2 pr-2">•</span>

        See <a href="/archive">Post Archive</a>
    </p>

    <br>

    <p>
        Did you know my daily focus goes to <strong>turning working with legacy code into joy</strong> again?

        <br>

        Mostly with awesome <a href="https://getrector.org/">instant refactoring tool called Rector</a>.
    </p>
</div>
    </body>
</html>

        <meta property="og:type" content="article" />
    <meta property="og:title" content="Collector Pattern for Dummies" />
    <meta property="og:description" content="I wrote *[Why is Collector Pattern so Awesome](/blog/2018/03/08/why-is-collector-pattern-so-awesome/)* a while ago, but I got feeling and feedback that it&#039;s way too complicated.

The pattern itself is simple, but put in framework context, it might be too confusing to understand.

That&#039;s why we look on collector pattern in minimalistic plain PHP way today.
" />
    <meta property="og:url" content="/blog/2018/06/14/collector-pattern-for-dummies" />

        <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@votrubaT">
    <meta name="twitter:title" content="Collector Pattern for Dummies" />
    <meta name="twitter:description" content="I wrote *[Why is Collector Pattern so Awesome](/blog/2018/03/08/why-is-collector-pattern-so-awesome/)* a while ago, but I got feeling and feedback that it&#039;s way too complicated.

The pattern itself is simple, but put in framework context, it might be too confusing to understand.

That&#039;s why we look on collector pattern in minimalistic plain PHP way today.
" />
