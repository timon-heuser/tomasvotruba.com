<!DOCTYPE html>
<html lang="en">
    <head>
    <title>How to run Rector and PHPStan on Huge Project in 3 Seconds with PHPStorm | Tomas Votruba</title>
    <meta charset="utf-8">
    <meta name="robots" content="index, follow">

        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">

    
    <link rel="alternate" type="application/rss+xml" title="Tomas Votruba Blog RSS" href="/rss.xml">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/solid.css" integrity="sha384-wnAC7ln+XN0UKdcPvJvtqIH3jOjs9pnKnq9qX68ImXvOGz2JuFoEiCjT8jyZQX2z" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/brands.css" integrity="sha384-nT8r1Kzllf71iZl81CdFzObMsaLOhqBU1JD2+XoAALbdtWaXDOlWOZTR4v1ktjPE" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/fontawesome.css" integrity="sha384-HbmWTHay9psM8qyzEKPc8odH4DsOuzdejtnr+OFtDmOcIVnhgReQ4GZBH7uwcjf6" crossorigin="anonymous">

        <link href="/assets/bootstrap/bootstrap.min.css" rel="stylesheet" type="text/css" />

    <link href="/assets/prism/prism.css" rel="stylesheet" type="text/css" />

        <link href="/assets/css/style.css" rel="stylesheet" type="text/css" />


        <link href="/assets/css/checklist.css" rel="stylesheet" type="text/css" />
</head>
    <body>
                <!-- post_id: 237 -->

        
<div class="hidden-sm-down">
    <nav class="navbar">
        <div class="container-fluid">
            <ul>
                <li id="logo">
                    <img src="https://avatars1.githubusercontent.com/u/924196?s=60&v=4" class="me_avatar">
                    Tomas Votruba
                </li>
                <li class="active">
                    <a href="/">Blog</a>
                </li>
                <li class="">
                    <a href="/php-framework-trends">Trends</a>
                </li>
                <li class="">
                    <a href="/clusters">Clusters</a>
                </li>
                <li class="">
                    <a href="/projects">Projects</a>
                </li>
                <li class="">
                    <a href="/mission">Mission</a>
                </li>
                <li class="">
                    <a href="/talks">Talks</a>
                </li>
                <li class="">
                    <a href="/contact">Contact</a>
                </li>
                <li id="top-menu-search">
                    <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction">
    <meta itemprop="target" content="https://www.google.com/search?q={q}"/>
    <input name="sitesearch" value="tomasvotruba.com" type="hidden"/>
    <input itemprop="query-input" type="text" id="search-query" class="form-control" required="required" name="q" placeholder="Search..." autocomplete="off"/>
</form>
                </li>
            </ul>
        </div>
    </nav>
</div>

<div class="hidden-md-up">
    <nav class="navbar" id="mobile-menu">
        <div class="container">
            <a href="/" class="col-3 col-sm-3 active">
                <em class="fas fa-book"></em>
                <br>
                Blog
            </a>


            <a href="/clusters" class="col-3 col-sm-3 ">
                <em class="fas fa-share-alt"></em>
                <br>
                Clusters
            </a>

            <a href="/projects" class="col-3 col-sm-3 ">
                <em class="fas fa-chart-bar"></em>
                <br>
                Trends
            </a>

            <a href="/contact" class="col-3 col-sm-3 ">
                <em class="fas fa-phone"></em>
                <br>
                Contact
            </a>
        </div>
    </nav>

    <div class="hidden-md-up text-center" id="top-menu-search-mobile">
        <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction">
    <meta itemprop="target" content="https://www.google.com/search?q={q}"/>
    <input name="sitesearch" value="tomasvotruba.com" type="hidden"/>
    <input itemprop="query-input" type="text" id="search-query" class="form-control" required="required" name="q" placeholder="Search..." autocomplete="off"/>
</form>
    </div>
</div>

        <div class="mainContent">
            <div class="container-fluid" id="post">
                <h1>How to run Rector and PHPStan on Huge Project in 3 Seconds with PHPStorm</h1>

                <ul class="list-inline post-metadata">
    <li class="list-inline-item mr-3">
        <em class="fas fa-clock fa-fw"></em>
        <strong>2 min</strong>
    </li>

    <li class="list-inline-item mr-3">
        <em class="fas fa-calendar fa-fw"></em>
        <time datetime="2020-02-Mon">
            
                            Mon, Feb 3
            
            </strike>        </time>
    </li>

    
            <li class="list-inline-item mr-3">
            <em class="fas fa-fw fa-comments"></em>
            <a href="/blog/2020/02/03/how-to-run-rector-and-phpstan-on-huge-project-in-3-seconds-with-phpstorm/#disqus_thread">X</a> comments
        </li>
    
    
            <li class="list-inline-item mr-3 text-primary">
            <em class="fab fa-fw fa-github"></em>
            <a href="https://github.com/tomasvotruba/tomasvotruba.com/edit/master/packages/blog/config/data/2020/2020-02-03-how-to-run-rector-and-phpstan-on-huge-project-in-3-seconds-with-phpstorm.md">Edit Post</a>
        </li>
    </ul>

                
                
                <div class="card card-bigger mb-5">
                    <div class="card-body">
                        <p>Today we'll look at the command line and run performance heavy dev tools like Rector or PHPStan on our projects. I'm guessing that it takes more than 10 seconds to run whatever project you use.
<br>
<br>
How would you like it be <strong>less than 3 seconds with just one click</strong> in PHPStorm?</p>
                    </div>
                </div>

                <p>Let's say we have a reasonably big codebase, like Rector, with over 70 000 lines of code. Projects I consult lately usually fit into 200-600 000 lines of code, though. But let's take Rector as the baseline, as that's the project we have data for.</p>
<p>We add a new feature, change test, fix a bug, 300 added lines, 200 removed.</p>
<p>Now, <strong>we want to run Rector and PHPStan to make sure the code is clean and working</strong>. So we run PHPStan:</p>
<img src="/assets/images/posts/2020/external_tools_normal_phpstan.gif" class="img-thumbnail">
<p>And wait...</p>
<p><br>
<br>
<br></p>
<p>...<strong>40 seconds</strong>!</p>
<p><br></p>
<h2 id="how-do-we-hack-it">How do we Hack It?</h2>
<p>It takes so long. We might adapt and <strong>push it into the remote repository and let the CI server handle it</strong>. After all, it's often much faster than our local laptop. I used this approach at big codebases so far.</p>
<p>Another way is to copy the directory path and run tool only on it:</p>
<pre><code class="language-bash">vendor/bin/phpstan analyse src/SomeDirectory
vendor/bin/rector process src/SomeDirectory</code></pre>
<p>But we have to:</p>
<ul>
<li>copy directory path or type it</li>
<li>open command line</li>
<li>type whole command we usually use</li>
<li>remove argument we typically use</li>
<li>add our directory argument</li>
<li>click to run it</li>
</ul>
<p>Instant flow killer :(</p>
<h2 id="too-slow-go-home">Too Slow? Go Home!</h2>
<p>When I talk with developers, this is one of the main reasons they don't use such tools. It takes too long to get feedback from them. It destroys their focus on the features.</p>
<blockquote class="blockquote text-center mt-5 mb-5">
Frustration is always the sign we should ask this question:
<br>
How can we do better?
</blockquote>
<p><br></p>
<h2 id="narrow-scope-increase-focus">Narrow Scope → Increase Focus</h2>
<p>Last week <a href="https://twitter.com/mikes_honza">Honza</a> showed me PHPStorm tip that fits <a href="/blog/2020/01/27/switch-travis-to-github-actions-to-reduce-stress/">into instant feedback loop flow</a> I discovered recently.</p>
<p><a href="https://twitter.com/mikes_honza/status/1222557580507127811"></p>
<img src="/assets/images/posts/2020/external_tools_tweet.png" class="img-thumbnail">
<p></a></p>
<p><strong>It might trim off some more frustration</strong> in your daily work and turn you into a flow developer as a result. The bigger your codebase, the more it might help you get under 3 seconds.</p>
<p><br></p>
<h2 id="how-does-it-work">How does it Work?</h2>
<p>You run <strong>the tool only on a selected directory in the left tree</strong>.</p>
<ul>
<li>Without the command line.</li>
<li>Without changing paths.</li>
<li>Without copy-pasting.</li>
</ul>
<h3 id="domain-directory-separation">Domain Directory Separation</h3>
<p>This approach requires us to keep a decoupled structure, e.g., with to <a href="/blog/2017/12/25/composer-local-packages-for-dummies/">local packages</a> or domain-driven design.</p>
<p>What does it mean? That our code that handles security is not all over the place in <code>/src</code> directory but in standalone <code>packages/Security</code> directory. So if we work with security, we <del>only</del> mostly work in that directory.</p>
<h2 id="how-to-configure-external-tool-in-phpstorm">How to Configure External Tool in PHPStorm?</h2>
<p>In PHPStorm open:</p>
<ul>
<li>Settings →</li>
<li>Tools →</li>
<li>External Tools</li>
</ul>
<p><br></p>
<p>Click on <em>+</em>:</p>
<img src="/assets/images/posts/2020/external_tool_add.png" class="img-thumbnail">
<p><br></p>
<p><strong>Name the tool and configure parameters</strong></p>
<ul>
<li>Program: <code>$ProjectFileDir$/vendor/bin/rector</code></li>
<li>Arguments: <code>process $FilePathRelativeToProjectRoot$</code></li>
<li>Working directory: <code>$ProjectFileDir$</code></li>
</ul>
<img src="/assets/images/posts/2020/external_tools_one.png" class="img-thumbnail">
<p><br></p>
<p>Save.</p>
<h2 id="how-to-use-it">How to Use It?</h2>
<p>Pick the directory you want to process in the file tree.</p>
<p>Run action.</p>
<p>Type &quot;Rector&quot; or &quot;PHPStan&quot; and hit enter:</p>
<img src="/assets/images/posts/2020/external_tools_rector.gif" class="img-thumbnail">
<p><br></p>
<p>Kaboom :) That's it!</p>
<p><br></p>
<p>Happy flow coding!</p>

                <br>

                <div class="row mb-5 mt-5">
                    <div class="col-12 mb-5">
                                                                            <a href="/blog/2020/01/27/switch-travis-to-github-actions-to-reduce-stress" class="d-block pt-4 pb-4 pl-4 pr-4 btn btn-success btn-wrappable">
                                <em class="fas fa-fw fa-forward"></em>
                                <strong>Read Next</strong>
                                <br>
                                <span class="text-bigger">
                                    Switch Travis to GitHub Actions to Reduce Stress
                                </span>
                            </a>
                                            </div>

                    <div class="col-12">
                        <a href="https://github.com/tomasvotruba/tomasvotruba.com/edit/master/packages/blog/config/data/2020/2020-02-03-how-to-run-rector-and-phpstan-on-huge-project-in-3-seconds-with-phpstorm.md" class="d-block btn btn-dark btn-wrappable">
                            <em class="fab fa-fw fa-github"></em>
                            <strong>Found a typo?</strong> Fix it and join team of 99&nbsp;contributors
                        </a>
                    </div>
                </div>

                <br>

                <a name="comments"></a>
                <div id="disqus_thread"></div>

<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://itsworthsharing.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
            </div>

            <script id="dsq-count-scr" src="https://itsworthsharing.disqus.com/count.js" async defer></script>
        </div>

        <script src="/assets/js/jquery-3.3.1.slim.min.js"></script>
<script src="/assets/js/cluster-checklist.js"></script>
<script src="/assets/js/cluster-expanable.js"></script>

<script src="/assets/js/cleaning-lady-checklist.js"></script>

<script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>

<script>
    ga=function(){ ga.q.push(arguments) };
    ga.q=[];
    ga.l=+new Date;
    ga('create', 'UA-46082345-1', 'auto');
    ga('send','pageview');
</script>
<script src="https://www.google-analytics.com/analytics.js" async defer></script>

<script src="/assets/prism/prism.js"></script>

<script>
    // sortable table
    $('.sortable_table').DataTable({
        // see https://datatables.net/examples/basic_init/filter_only.html
        "searching": false,
        "paging": false,
        "info": false,
        "order": [[1, "desc"]],
        // see https://datatables.net/examples/advanced_init/sort_direction_control.html
        "aoColumns": [
            null,
            { "orderSequence": [ "desc", "asc" ] },
            { "orderSequence": [ "desc", "asc" ] },
            { "orderSequence": [ "desc", "asc" ] }
        ]
    });
</script>

<div class="text-center mt-5" id="footer">
    <p>
        Thank you <a href="/thank-you">99 people</a>, who contributed this blog

        <span class="pl-2 pr-2">•</span>

        See <a href="/archive">Post Archive</a>
    </p>

    <br>

    <p>
        Did you know my daily focus goes to <strong>turning working with legacy code into joy</strong> again?

        <br>

        Mostly with awesome <a href="https://getrector.org/">instant refactoring tool called Rector</a>.
    </p>
</div>
    </body>
</html>

        <meta property="og:type" content="article" />
    <meta property="og:title" content="How to run Rector and PHPStan on Huge Project in 3 Seconds with PHPStorm" />
    <meta property="og:description" content="Today we&#039;ll look at the command line and run performance heavy dev tools like Rector or PHPStan on our projects. I&#039;m guessing that it takes more than 10 seconds to run whatever project you use.


How would you like it be **less than 3 seconds with just one click** in PHPStorm?
" />
    <meta property="og:url" content="/blog/2020/02/03/how-to-run-rector-and-phpstan-on-huge-project-in-3-seconds-with-phpstorm" />

        <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@votrubaT">
    <meta name="twitter:title" content="How to run Rector and PHPStan on Huge Project in 3 Seconds with PHPStorm" />
    <meta name="twitter:description" content="Today we&#039;ll look at the command line and run performance heavy dev tools like Rector or PHPStan on our projects. I&#039;m guessing that it takes more than 10 seconds to run whatever project you use.


How would you like it be **less than 3 seconds with just one click** in PHPStorm?
" />
